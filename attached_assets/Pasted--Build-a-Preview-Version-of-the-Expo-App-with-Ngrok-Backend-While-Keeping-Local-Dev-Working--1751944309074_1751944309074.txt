
 

 Build a Preview Version of the Expo App with Ngrok Backend (While Keeping Local Dev Working). 


I want to build a test version of my Expo app for limited user testing using a preview build that connects to my backend via an Ngrok URL.

Please follow these exact steps:

---

### 1. üîÅ **Dynamic API URL Handling**
- Replace any hardcoded instances of `localhost` or `127.0.0.1` in the codebase.
- Instead, load the API base URL from an environment variable.

---

### 2. üß© **Create `.env` file** at the root of the project:
```env
API_URL=https://75ad075cf608.ngrok-free.app
````

* This is the **Ngrok backend URL** used during preview builds.
* Keep a second `.env.local` file if needed for local development:

```env
API_URL=http://127.0.0.1:5000
```

---

### 3. ‚öôÔ∏è **Configure the app to use environment variables**

* Use `react-native-dotenv` or `expo-constants` to load `.env` values.
* In your API services (e.g. `api.ts`), read:

```ts
import { API_URL } from '@env';
// OR
import Constants from 'expo-constants';
const API = Constants?.expoConfig?.extra?.API_URL || 'fallback-url';
```

* Update `app.config.js` or `app.config.ts` to inject the env:

```js
import 'dotenv/config';

export default {
  expo: {
    extra: {
      API_URL: process.env.API_URL,
    },
  },
};
```

---

### 4. üì¶ **Create or update `eas.json` with a `preview` profile**:

```json
{
  "build": {
    "preview": {
      "developmentClient": true,
      "distribution": "internal",
      "android": {
        "buildType": "apk"
      },
      "ios": {
        "simulator": true
      },
      "env": {
        "API_URL": "https://75ad075cf608.ngrok-free.app"
      }
    }
  }
}
```

‚úÖ This makes sure `API_URL` is injected correctly during the build.

---

### 5. üöÄ **Run preview build**

```bash
eas build --profile preview --platform all
```

---

### 6. üì¶ After build completes, please provide:

* ‚úÖ Direct download link to the **Android APK**
* ‚úÖ QR code or install link for **iOS** (Expo Go or TestFlight)
* ‚úÖ Confirmation that `.env` and `eas.json` are working properly
* ‚úÖ Confirm that the app connects successfully to the Ngrok backend
* ‚úÖ Confirm that development still works with `.env.local` and `localhost` setup

---

üéØ Goal:
To distribute this version to a few testers (friends or team members) for limited feedback before public release, without affecting local development flow.

